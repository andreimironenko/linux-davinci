From: gregkh@suse.de
Subject: kobject warning stuff

Good for development, don't push it to mainline as there are too many false positives.


Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 lib/kobject.c |    7 +++++++
 1 files changed, 7 insertions(+)

--- gregkh-2.6.orig/lib/kobject.c	2005-05-09 09:07:22.000000000 -0700
+++ gregkh-2.6/lib/kobject.c	2005-05-09 09:15:45.000000000 -0700
@@ -121,6 +121,7 @@
  */
 void kobject_init(struct kobject * kobj)
 {
+	WARN_ON(atomic_read(&kobj->kref.refcount));
 	kref_init(&kobj->kref);
 	INIT_LIST_HEAD(&kobj->entry);
 	kobj->kset = kset_get(kobj->kset);
@@ -345,6 +346,12 @@
 	kobj->k_name = NULL;
 	if (t && t->release)
 		t->release(kobj);
+	else
+		pr_debug("kobject '%s' does not have a release() function, "
+			"if this is not a directory kobject, it is broken "
+			"and must be fixed.\n",
+			kobj->name);
+
 	if (s)
 		kset_put(s);
 	if (parent) 
