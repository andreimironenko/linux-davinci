From oliver@neukum.org Fri Apr 20 11:51:02 2007
From: Oliver Neukum <oliver@neukum.org>
Date: Fri, 20 Apr 2007 20:50:48 +0200
Subject: usbfs micro optimitation
To: gregkh@suse.de, linux-usb-devel@lists.sourceforge.net
Message-ID: <200704202050.49246.oliver@neukum.org>
Content-Disposition: inline


the memory barrier is needed only with smp.

Signed-off-by: Oliver Neukum <oneukum@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/core/devio.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/usb/core/devio.c
+++ b/drivers/usb/core/devio.c
@@ -580,7 +580,7 @@ static int usbdev_open(struct inode *ino
 	ps->disccontext = NULL;
 	ps->ifclaimed = 0;
 	security_task_getsecid(current, &ps->secid);
-	wmb();
+	smp_wmb();
 	list_add_tail(&ps->list, &dev->filelist);
 	file->private_data = ps;
  out:
