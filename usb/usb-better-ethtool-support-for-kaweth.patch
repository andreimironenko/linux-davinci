From oneukum@suse.de Tue Jan 16 03:01:29 2007
From: Oliver Neukum <oneukum@suse.de>
Date: Tue, 16 Jan 2007 12:01:26 +0100
Subject: USB: better ethtool support for kaweth
To: gregkh@suse.de, linux-usb-devel@lists.sourceforge.net
Message-ID: <200701161201.26617.oneukum@suse.de>
Content-Disposition: inline

this implements enough ethtool support to make NetworkManager happy.

Signed-off-by: Oliver Neukum <oneukum@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/net/kaweth.c |   12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

--- gregkh-2.6.orig/drivers/usb/net/kaweth.c
+++ gregkh-2.6/drivers/usb/net/kaweth.c
@@ -742,12 +742,22 @@ static int kaweth_close(struct net_devic
 
 static void kaweth_get_drvinfo(struct net_device *dev, struct ethtool_drvinfo *info)
 {
+	struct kaweth_device *kaweth = netdev_priv(dev);
 
 	strlcpy(info->driver, driver_name, sizeof(info->driver));
+	usb_make_path(kaweth->dev, info->bus_info, sizeof (info->bus_info));
+}
+
+static u32 kaweth_get_link(struct net_device *dev)
+{
+	struct kaweth_device *kaweth = netdev_priv(dev);
+
+	return kaweth->linkstate;
 }
 
 static struct ethtool_ops ops = {
-	.get_drvinfo = kaweth_get_drvinfo
+	.get_drvinfo	= kaweth_get_drvinfo,
+	.get_link	= kaweth_get_link
 };
 
 /****************************************************************
