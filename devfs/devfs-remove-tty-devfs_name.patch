From foo@baz.org Sun Jun  5 14:33:21 2005
Date: Mon, 20 Jun 2005 21:15:16 -0700
To: Greg KH <gregkh@suse.de>
From: Greg Kroah-Hartman <gregkh@suse.de>
Subject: devfs: Remove the tty_driver devfs_name field as it's no longer needed

Also fixes all drivers that set this field.

Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/char/cyclades.c         |    1 -
 drivers/char/epca.c             |    1 -
 drivers/char/esp.c              |    1 -
 drivers/char/hvc_console.c      |    1 -
 drivers/char/hvcs.c             |    1 -
 drivers/char/hvsi.c             |    1 -
 drivers/char/ip2main.c          |    1 -
 drivers/char/isicom.c           |    1 -
 drivers/char/moxa.c             |    1 -
 drivers/char/pty.c              |    2 --
 drivers/char/riscom8.c          |    1 -
 drivers/char/rocket.c           |    1 -
 drivers/char/serial167.c        |    1 -
 drivers/char/stallion.c         |    1 -
 drivers/char/viocons.c          |    1 -
 drivers/char/vme_scc.c          |    1 -
 drivers/char/vt.c               |    1 -
 drivers/isdn/capi/capi.c        |    1 -
 drivers/isdn/i4l/isdn_tty.c     |    1 -
 drivers/s390/char/tty3270.c     |    1 -
 drivers/s390/net/ctctty.c       |    1 -
 drivers/tc/zs.c                 |    1 -
 drivers/usb/class/cdc-acm.c     |    1 -
 drivers/usb/gadget/serial.c     |    1 -
 drivers/usb/serial/usb-serial.c |    1 -
 include/linux/tty_driver.h      |    1 -
 net/bluetooth/rfcomm/tty.c      |    1 -
 net/irda/ircomm/ircomm_tty.c    |    1 -
 28 files changed, 29 deletions(-)

--- gregkh-2.6.orig/drivers/char/cyclades.c
+++ gregkh-2.6/drivers/char/cyclades.c
@@ -5251,7 +5251,6 @@ cy_init(void)
     cy_serial_driver->owner = THIS_MODULE;
     cy_serial_driver->driver_name = "cyclades";
     cy_serial_driver->name = "ttyC";
-    cy_serial_driver->devfs_name = "tts/C";
     cy_serial_driver->major = CYCLADES_MAJOR;
     cy_serial_driver->minor_start = 0;
     cy_serial_driver->type = TTY_DRIVER_TYPE_SERIAL;
--- gregkh-2.6.orig/drivers/char/epca.c
+++ gregkh-2.6/drivers/char/epca.c
@@ -1233,7 +1233,6 @@ static int __init pc_init(void)
 
 	pc_driver->owner = THIS_MODULE;
 	pc_driver->name = "ttyD"; 
-	pc_driver->devfs_name = "tts/D";
 	pc_driver->major = DIGI_MAJOR; 
 	pc_driver->minor_start = 0;
 	pc_driver->type = TTY_DRIVER_TYPE_SERIAL;
--- gregkh-2.6.orig/drivers/char/esp.c
+++ gregkh-2.6/drivers/char/esp.c
@@ -2464,7 +2464,6 @@ static int __init espserial_init(void)
 	
 	esp_driver->owner = THIS_MODULE;
 	esp_driver->name = "ttyP";
-	esp_driver->devfs_name = "tts/P";
 	esp_driver->major = ESP_IN_MAJOR;
 	esp_driver->minor_start = 0;
 	esp_driver->type = TTY_DRIVER_TYPE_SERIAL;
--- gregkh-2.6.orig/drivers/char/hvc_console.c
+++ gregkh-2.6/drivers/char/hvc_console.c
@@ -827,7 +827,6 @@ int __init hvc_init(void)
 		return -ENOMEM;
 
 	hvc_driver->owner = THIS_MODULE;
-	hvc_driver->devfs_name = "hvc/";
 	hvc_driver->driver_name = "hvc";
 	hvc_driver->name = "hvc";
 	hvc_driver->major = HVC_MAJOR;
--- gregkh-2.6.orig/drivers/char/hvsi.c
+++ gregkh-2.6/drivers/char/hvsi.c
@@ -1154,7 +1154,6 @@ static int __init hvsi_init(void)
 		return -ENOMEM;
 
 	hvsi_driver->owner = THIS_MODULE;
-	hvsi_driver->devfs_name = "hvsi/";
 	hvsi_driver->driver_name = "hvsi";
 	hvsi_driver->name = "hvsi";
 	hvsi_driver->major = HVSI_MAJOR;
--- gregkh-2.6.orig/drivers/char/isicom.c
+++ gregkh-2.6/drivers/char/isicom.c
@@ -1581,7 +1581,6 @@ static int __devinit isicom_register_tty
 
 	isicom_normal->owner			= THIS_MODULE;
 	isicom_normal->name 			= "ttyM";
-	isicom_normal->devfs_name	 	= "isicom/";
 	isicom_normal->major			= ISICOM_NMAJOR;
 	isicom_normal->minor_start		= 0;
 	isicom_normal->type			= TTY_DRIVER_TYPE_SERIAL;
--- gregkh-2.6.orig/drivers/char/moxa.c
+++ gregkh-2.6/drivers/char/moxa.c
@@ -342,7 +342,6 @@ static int __init moxa_init(void)
 	init_MUTEX(&moxaBuffSem);
 	moxaDriver->owner = THIS_MODULE;
 	moxaDriver->name = "ttyMX";
-	moxaDriver->devfs_name = "tts/a";
 	moxaDriver->major = ttymajor;
 	moxaDriver->minor_start = 0;
 	moxaDriver->type = TTY_DRIVER_TYPE_SERIAL;
--- gregkh-2.6.orig/drivers/char/pty.c
+++ gregkh-2.6/drivers/char/pty.c
@@ -264,7 +264,6 @@ static void __init legacy_pty_init(void)
 	pty_driver->owner = THIS_MODULE;
 	pty_driver->driver_name = "pty_master";
 	pty_driver->name = "pty";
-	pty_driver->devfs_name = "pty/m";
 	pty_driver->major = PTY_MASTER_MAJOR;
 	pty_driver->minor_start = 0;
 	pty_driver->type = TTY_DRIVER_TYPE_PTY;
@@ -282,7 +281,6 @@ static void __init legacy_pty_init(void)
 	pty_slave_driver->owner = THIS_MODULE;
 	pty_slave_driver->driver_name = "pty_slave";
 	pty_slave_driver->name = "ttyp";
-	pty_slave_driver->devfs_name = "pty/s";
 	pty_slave_driver->major = PTY_SLAVE_MAJOR;
 	pty_slave_driver->minor_start = 0;
 	pty_slave_driver->type = TTY_DRIVER_TYPE_PTY;
--- gregkh-2.6.orig/drivers/char/riscom8.c
+++ gregkh-2.6/drivers/char/riscom8.c
@@ -1634,7 +1634,6 @@ static inline int rc_init_drivers(void)
 	memset(IRQ_to_board, 0, sizeof(IRQ_to_board));
 	riscom_driver->owner = THIS_MODULE;
 	riscom_driver->name = "ttyL";
-	riscom_driver->devfs_name = "tts/L";
 	riscom_driver->major = RISCOM8_NORMAL_MAJOR;
 	riscom_driver->type = TTY_DRIVER_TYPE_SERIAL;
 	riscom_driver->subtype = SERIAL_TYPE_NORMAL;
--- gregkh-2.6.orig/drivers/char/rocket.c
+++ gregkh-2.6/drivers/char/rocket.c
@@ -2443,7 +2443,6 @@ static int __init rp_init(void)
 
 	rocket_driver->owner = THIS_MODULE;
 	rocket_driver->flags = TTY_DRIVER_NO_DEVFS;
-	rocket_driver->devfs_name = "tts/R";
 	rocket_driver->name = "ttyR";
 	rocket_driver->driver_name = "Comtrol RocketPort";
 	rocket_driver->major = TTY_ROCKET_MAJOR;
--- gregkh-2.6.orig/drivers/char/serial167.c
+++ gregkh-2.6/drivers/char/serial167.c
@@ -2235,7 +2235,6 @@ scrn[1] = '\0';
     /* Initialize the tty_driver structure */
     
     cy_serial_driver->owner = THIS_MODULE;
-    cy_serial_driver->devfs_name = "tts/";
     cy_serial_driver->name = "ttyS";
     cy_serial_driver->major = TTY_MAJOR;
     cy_serial_driver->minor_start = 64;
--- gregkh-2.6.orig/drivers/char/stallion.c
+++ gregkh-2.6/drivers/char/stallion.c
@@ -3092,7 +3092,6 @@ static int __init stl_init(void)
 	stl_serial->owner = THIS_MODULE;
 	stl_serial->driver_name = stl_drvname;
 	stl_serial->name = "ttyE";
-	stl_serial->devfs_name = "tts/E";
 	stl_serial->major = STL_SERIALMAJOR;
 	stl_serial->minor_start = 0;
 	stl_serial->type = TTY_DRIVER_TYPE_SERIAL;
--- gregkh-2.6.orig/drivers/char/viocons.c
+++ gregkh-2.6/drivers/char/viocons.c
@@ -1152,7 +1152,6 @@ static int __init viocons_init2(void)
 	viotty_driver = alloc_tty_driver(VTTY_PORTS);
 	viotty_driver->owner = THIS_MODULE;
 	viotty_driver->driver_name = "vioconsole";
-	viotty_driver->devfs_name = "vcs/";
 	viotty_driver->name = "tty";
 	viotty_driver->name_base = 1;
 	viotty_driver->major = TTY_MAJOR;
--- gregkh-2.6.orig/drivers/char/vme_scc.c
+++ gregkh-2.6/drivers/char/vme_scc.c
@@ -147,7 +147,6 @@ static int scc_init_drivers(void)
 	scc_driver->owner = THIS_MODULE;
 	scc_driver->driver_name = "scc";
 	scc_driver->name = "ttyS";
-	scc_driver->devfs_name = "tts/";
 	scc_driver->major = TTY_MAJOR;
 	scc_driver->minor_start = SCC_MINOR_BASE;
 	scc_driver->type = TTY_DRIVER_TYPE_SERIAL;
--- gregkh-2.6.orig/drivers/char/vt.c
+++ gregkh-2.6/drivers/char/vt.c
@@ -2627,7 +2627,6 @@ int __init vty_init(void)
 	if (!console_driver)
 		panic("Couldn't allocate console driver\n");
 	console_driver->owner = THIS_MODULE;
-	console_driver->devfs_name = "vc/";
 	console_driver->name = "tty";
 	console_driver->name_base = 1;
 	console_driver->major = TTY_MAJOR;
--- gregkh-2.6.orig/include/linux/tty_driver.h
+++ gregkh-2.6/include/linux/tty_driver.h
@@ -157,7 +157,6 @@ struct tty_driver {
 	struct cdev cdev;
 	struct module	*owner;
 	const char	*driver_name;
-	const char	*devfs_name;
 	const char	*name;
 	int	name_base;	/* offset of printed name */
 	int	major;		/* major device number */
--- gregkh-2.6.orig/drivers/char/hvcs.c
+++ gregkh-2.6/drivers/char/hvcs.c
@@ -1364,7 +1364,6 @@ static int __init hvcs_module_init(void)
 
 	hvcs_tty_driver->driver_name = hvcs_driver_name;
 	hvcs_tty_driver->name = hvcs_device_node;
-	hvcs_tty_driver->devfs_name = hvcs_device_node;
 
 	/*
 	 * We'll let the system assign us a major number, indicated by leaving
--- gregkh-2.6.orig/drivers/char/ip2main.c
+++ gregkh-2.6/drivers/char/ip2main.c
@@ -671,7 +671,6 @@ ip2_loadmain(int *iop, int *irqp, unsign
 
 	ip2_tty_driver->owner		    = THIS_MODULE;
 	ip2_tty_driver->name                 = "ttyF";
-	ip2_tty_driver->devfs_name	    = "tts/F";
 	ip2_tty_driver->driver_name          = pcDriver_name;
 	ip2_tty_driver->major                = IP2_TTY_MAJOR;
 	ip2_tty_driver->minor_start          = 0;
--- gregkh-2.6.orig/drivers/isdn/capi/capi.c
+++ gregkh-2.6/drivers/isdn/capi/capi.c
@@ -1326,7 +1326,6 @@ static int capinc_tty_init(void)
 
 	drv->owner = THIS_MODULE;
 	drv->driver_name = "capi_nc";
-	drv->devfs_name = "capi/";
 	drv->name = "capi";
 	drv->major = capi_ttymajor;
 	drv->minor_start = 0;
--- gregkh-2.6.orig/drivers/isdn/i4l/isdn_tty.c
+++ gregkh-2.6/drivers/isdn/i4l/isdn_tty.c
@@ -1889,7 +1889,6 @@ isdn_tty_modem_init(void)
 	if (!m->tty_modem)
 		return -ENOMEM;
 	m->tty_modem->name = "ttyI";
-	m->tty_modem->devfs_name = "isdn/ttyI";
 	m->tty_modem->major = ISDN_TTY_MAJOR;
 	m->tty_modem->minor_start = 0;
 	m->tty_modem->type = TTY_DRIVER_TYPE_SERIAL;
--- gregkh-2.6.orig/drivers/s390/char/tty3270.c
+++ gregkh-2.6/drivers/s390/char/tty3270.c
@@ -1788,7 +1788,6 @@ tty3270_init(void)
 	 * proc_entry, set_termios, flush_buffer, set_ldisc, write_proc
 	 */
 	driver->owner = THIS_MODULE;
-	driver->devfs_name = "ttyTUB/";
 	driver->driver_name = "ttyTUB";
 	driver->name = "ttyTUB";
 	driver->major = IBM_TTY3270_MAJOR;
--- gregkh-2.6.orig/drivers/s390/net/ctctty.c
+++ gregkh-2.6/drivers/s390/net/ctctty.c
@@ -1134,7 +1134,6 @@ ctc_tty_init(void)
 		return -ENOMEM;
 	}
 
-	device->devfs_name = "ctc/" CTC_TTY_NAME;
 	device->name = CTC_TTY_NAME;
 	device->major = CTC_TTY_MAJOR;
 	device->minor_start = 0;
--- gregkh-2.6.orig/drivers/tc/zs.c
+++ gregkh-2.6/drivers/tc/zs.c
@@ -1748,7 +1748,6 @@ int __init zs_init(void)
 	/* Not all of this is exactly right for us. */
 
 	serial_driver->owner = THIS_MODULE;
-	serial_driver->devfs_name = "tts/";
 	serial_driver->name = "ttyS";
 	serial_driver->major = TTY_MAJOR;
 	serial_driver->minor_start = 64;
--- gregkh-2.6.orig/drivers/usb/class/cdc-acm.c
+++ gregkh-2.6/drivers/usb/class/cdc-acm.c
@@ -1127,7 +1127,6 @@ static int __init acm_init(void)
 	acm_tty_driver->owner = THIS_MODULE,
 	acm_tty_driver->driver_name = "acm",
 	acm_tty_driver->name = "ttyACM",
-	acm_tty_driver->devfs_name = "usb/acm/",
 	acm_tty_driver->major = ACM_TTY_MAJOR,
 	acm_tty_driver->minor_start = 0,
 	acm_tty_driver->type = TTY_DRIVER_TYPE_SERIAL,
--- gregkh-2.6.orig/drivers/usb/gadget/serial.c
+++ gregkh-2.6/drivers/usb/gadget/serial.c
@@ -660,7 +660,6 @@ static int __init gs_module_init(void)
 	gs_tty_driver->owner = THIS_MODULE;
 	gs_tty_driver->driver_name = GS_SHORT_NAME;
 	gs_tty_driver->name = "ttygs";
-	gs_tty_driver->devfs_name = "usb/ttygs/";
 	gs_tty_driver->major = GS_MAJOR;
 	gs_tty_driver->minor_start = GS_MINOR_START;
 	gs_tty_driver->type = TTY_DRIVER_TYPE_SERIAL;
--- gregkh-2.6.orig/drivers/usb/serial/usb-serial.c
+++ gregkh-2.6/drivers/usb/serial/usb-serial.c
@@ -1069,7 +1069,6 @@ static int __init usb_serial_init(void)
 
 	usb_serial_tty_driver->owner = THIS_MODULE;
 	usb_serial_tty_driver->driver_name = "usbserial";
-	usb_serial_tty_driver->devfs_name = "usb/tts/";
 	usb_serial_tty_driver->name = 	"ttyUSB";
 	usb_serial_tty_driver->major = SERIAL_TTY_MAJOR;
 	usb_serial_tty_driver->minor_start = 0;
--- gregkh-2.6.orig/net/bluetooth/rfcomm/tty.c
+++ gregkh-2.6/net/bluetooth/rfcomm/tty.c
@@ -1025,7 +1025,6 @@ int rfcomm_init_ttys(void)
 
 	rfcomm_tty_driver->owner	= THIS_MODULE;
 	rfcomm_tty_driver->driver_name	= "rfcomm";
-	rfcomm_tty_driver->devfs_name	= "bluetooth/rfcomm/";
 	rfcomm_tty_driver->name		= "rfcomm";
 	rfcomm_tty_driver->major	= RFCOMM_TTY_MAJOR;
 	rfcomm_tty_driver->minor_start	= RFCOMM_TTY_MINOR;
--- gregkh-2.6.orig/net/irda/ircomm/ircomm_tty.c
+++ gregkh-2.6/net/irda/ircomm/ircomm_tty.c
@@ -124,7 +124,6 @@ static int __init ircomm_tty_init(void)
 	driver->owner		= THIS_MODULE;
 	driver->driver_name     = "ircomm";
 	driver->name            = "ircomm";
-	driver->devfs_name      = "ircomm";
 	driver->major           = IRCOMM_TTY_MAJOR;
 	driver->minor_start     = IRCOMM_TTY_MINOR;
 	driver->type            = TTY_DRIVER_TYPE_SERIAL;
