From foo@baz.org Sun Jun  5 14:33:21 2005
Date: Mon, 20 Jun 2005 21:15:16 -0700
To: Greg KH <gregkh@suse.de>
From: Greg Kroah-Hartman <gregkh@suse.de>
Subject: devfs: Remove devfs support from the serial subsystem

Also fixes all serial drivers.

Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>


---
 drivers/serial/21285.c        |    1 -
 drivers/serial/8250.c         |    1 -
 drivers/serial/at91_serial.c  |    1 -
 drivers/serial/au1x00_uart.c  |    1 -
 drivers/serial/dz.c           |    4 ----
 drivers/serial/imx.c          |    1 -
 drivers/serial/ip22zilog.c    |    1 -
 drivers/serial/m32r_sio.c     |    1 -
 drivers/serial/mcfserial.c    |    1 -
 drivers/serial/mpc52xx_uart.c |    1 -
 drivers/serial/mpsc.c         |    2 --
 drivers/serial/pmac_zilog.c   |    1 -
 drivers/serial/pxa.c          |    1 -
 drivers/serial/s3c2410.c      |    2 --
 drivers/serial/sa1100.c       |    1 -
 drivers/serial/serial_core.c  |    3 +--
 drivers/serial/serial_txx9.c  |    3 ---
 drivers/serial/sh-sci.c       |    3 ---
 drivers/serial/sunsab.c       |    1 -
 drivers/serial/sunsu.c        |    1 -
 drivers/serial/sunzilog.c     |    1 -
 drivers/serial/v850e_uart.c   |    1 -
 drivers/serial/vr41xx_siu.c   |    1 -
 include/linux/serial_core.h   |    1 -
 24 files changed, 1 insertion(+), 34 deletions(-)

--- gregkh-2.6.orig/drivers/serial/21285.c
+++ gregkh-2.6/drivers/serial/21285.c
@@ -479,7 +479,6 @@ static struct uart_driver serial21285_re
 	.owner			= THIS_MODULE,
 	.driver_name		= "ttyFB",
 	.dev_name		= "ttyFB",
-	.devfs_name             = "ttyFB",
 	.major			= SERIAL_21285_MAJOR,
 	.minor			= SERIAL_21285_MINOR,
 	.nr			= 1,
--- gregkh-2.6.orig/drivers/serial/8250.c
+++ gregkh-2.6/drivers/serial/8250.c
@@ -2310,7 +2310,6 @@ int __init serial8250_start_console(stru
 static struct uart_driver serial8250_reg = {
 	.owner			= THIS_MODULE,
 	.driver_name		= "serial",
-	.devfs_name		= "tts/",
 	.dev_name		= "ttyS",
 	.major			= TTY_MAJOR,
 	.minor			= 64,
--- gregkh-2.6.orig/drivers/serial/at91_serial.c
+++ gregkh-2.6/drivers/serial/at91_serial.c
@@ -839,7 +839,6 @@ static struct uart_driver at91_uart = {
 	.owner			= THIS_MODULE,
 	.driver_name		= AT91_DEVICENAME,
 	.dev_name		= AT91_DEVICENAME,
-	.devfs_name		= AT91_DEVICENAME,
 	.major			= SERIAL_AT91_MAJOR,
 	.minor			= MINOR_START,
 	.nr			= AT91_NR_UART,
--- gregkh-2.6.orig/drivers/serial/au1x00_uart.c
+++ gregkh-2.6/drivers/serial/au1x00_uart.c
@@ -1212,7 +1212,6 @@ console_initcall(serial8250_console_init
 static struct uart_driver serial8250_reg = {
 	.owner			= THIS_MODULE,
 	.driver_name		= "serial",
-	.devfs_name		= "tts/",
 	.dev_name		= "ttyS",
 	.major			= TTY_MAJOR,
 	.minor			= 64,
--- gregkh-2.6.orig/drivers/serial/dz.c
+++ gregkh-2.6/drivers/serial/dz.c
@@ -768,11 +768,7 @@ void __init dz_serial_console_init(void)
 static struct uart_driver dz_reg = {
 	.owner			= THIS_MODULE,
 	.driver_name		= "serial",
-#ifdef CONFIG_DEVFS
-	.dev_name		= "tts/%d",
-#else
 	.dev_name		= "ttyS%d",
-#endif
 	.major			= TTY_MAJOR,
 	.minor			= 64,
 	.nr			= DZ_NB_PORT,
--- gregkh-2.6.orig/drivers/serial/imx.c
+++ gregkh-2.6/drivers/serial/imx.c
@@ -903,7 +903,6 @@ static struct uart_driver imx_reg = {
 	.owner          = THIS_MODULE,
 	.driver_name    = DRIVER_NAME,
 	.dev_name       = "ttySMX",
-	.devfs_name	= "ttsmx/",
 	.major          = SERIAL_IMX_MAJOR,
 	.minor          = MINOR_START,
 	.nr             = ARRAY_SIZE(imx_ports),
--- gregkh-2.6.orig/drivers/serial/ip22zilog.c
+++ gregkh-2.6/drivers/serial/ip22zilog.c
@@ -1085,7 +1085,6 @@ static struct console ip22zilog_console 
 static struct uart_driver ip22zilog_reg = {
 	.owner		= THIS_MODULE,
 	.driver_name	= "serial",
-	.devfs_name	= "tts/",
 	.dev_name	= "ttyS",
 	.major		= TTY_MAJOR,
 	.minor		= 64,
--- gregkh-2.6.orig/drivers/serial/m32r_sio.c
+++ gregkh-2.6/drivers/serial/m32r_sio.c
@@ -1133,7 +1133,6 @@ console_initcall(m32r_sio_console_init);
 static struct uart_driver m32r_sio_reg = {
 	.owner			= THIS_MODULE,
 	.driver_name		= "sio",
-	.devfs_name		= "tts/",
 	.dev_name		= "ttyS",
 	.major			= TTY_MAJOR,
 	.minor			= 64,
--- gregkh-2.6.orig/drivers/serial/mcfserial.c
+++ gregkh-2.6/drivers/serial/mcfserial.c
@@ -1691,7 +1691,6 @@ mcfrs_init(void)
 	/* Initialize the tty_driver structure */
 	mcfrs_serial_driver->owner = THIS_MODULE;
 	mcfrs_serial_driver->name = "ttyS";
-	mcfrs_serial_driver->devfs_name = "ttys/";
 	mcfrs_serial_driver->driver_name = "serial";
 	mcfrs_serial_driver->major = TTY_MAJOR;
 	mcfrs_serial_driver->minor_start = 64;
--- gregkh-2.6.orig/drivers/serial/mpc52xx_uart.c
+++ gregkh-2.6/drivers/serial/mpc52xx_uart.c
@@ -693,7 +693,6 @@ static struct uart_driver mpc52xx_uart_d
 	.owner		= THIS_MODULE,
 	.driver_name	= "mpc52xx_psc_uart",
 	.dev_name	= "ttyPSC",
-	.devfs_name	= "ttyPSC",
 	.major		= SERIAL_PSC_MAJOR,
 	.minor		= SERIAL_PSC_MINOR,
 	.nr		= MPC52xx_PSC_MAXNUM,
--- gregkh-2.6.orig/drivers/serial/mpsc.c
+++ gregkh-2.6/drivers/serial/mpsc.c
@@ -63,7 +63,6 @@
 #define MPSC_MAJOR		204
 #define MPSC_MINOR_START	44
 #define	MPSC_DRIVER_NAME	"MPSC"
-#define	MPSC_DEVFS_NAME		"ttymm/"
 #define	MPSC_DEV_NAME		"ttyMM"
 #define	MPSC_VERSION		"1.00"
 
@@ -1611,7 +1610,6 @@ static struct platform_driver mpsc_share
 static struct uart_driver mpsc_reg = {
 	.owner       = THIS_MODULE,
 	.driver_name = MPSC_DRIVER_NAME,
-	.devfs_name  = MPSC_DEVFS_NAME,
 	.dev_name    = MPSC_DEV_NAME,
 	.major       = MPSC_MAJOR,
 	.minor       = MPSC_MINOR_START,
--- gregkh-2.6.orig/drivers/serial/pmac_zilog.c
+++ gregkh-2.6/drivers/serial/pmac_zilog.c
@@ -101,7 +101,6 @@ static DEFINE_MUTEX(pmz_irq_mutex);
 static struct uart_driver pmz_uart_reg = {
 	.owner		=	THIS_MODULE,
 	.driver_name	=	"ttyS",
-	.devfs_name	=	"tts/",
 	.dev_name	=	"ttyS",
 	.major		=	TTY_MAJOR,
 };
--- gregkh-2.6.orig/drivers/serial/pxa.c
+++ gregkh-2.6/drivers/serial/pxa.c
@@ -781,7 +781,6 @@ static struct uart_pxa_port serial_pxa_p
 static struct uart_driver serial_pxa_reg = {
 	.owner		= THIS_MODULE,
 	.driver_name	= "PXA serial",
-	.devfs_name	= "tts/",
 	.dev_name	= "ttyS",
 	.major		= TTY_MAJOR,
 	.minor		= 64,
--- gregkh-2.6.orig/drivers/serial/s3c2410.c
+++ gregkh-2.6/drivers/serial/s3c2410.c
@@ -149,7 +149,6 @@ s3c24xx_serial_dbg(const char *fmt, ...)
 /* UART name and device definitions */
 
 #define S3C24XX_SERIAL_NAME	"ttySAC"
-#define S3C24XX_SERIAL_DEVFS    "tts/"
 #define S3C24XX_SERIAL_MAJOR	204
 #define S3C24XX_SERIAL_MINOR	64
 
@@ -950,7 +949,6 @@ static struct uart_driver s3c24xx_uart_d
 	.nr		= 3,
 	.cons		= S3C24XX_SERIAL_CONSOLE,
 	.driver_name	= S3C24XX_SERIAL_NAME,
-	.devfs_name	= S3C24XX_SERIAL_DEVFS,
 	.major		= S3C24XX_SERIAL_MAJOR,
 	.minor		= S3C24XX_SERIAL_MINOR,
 };
--- gregkh-2.6.orig/drivers/serial/sa1100.c
+++ gregkh-2.6/drivers/serial/sa1100.c
@@ -816,7 +816,6 @@ static struct uart_driver sa1100_reg = {
 	.owner			= THIS_MODULE,
 	.driver_name		= "ttySA",
 	.dev_name		= "ttySA",
-	.devfs_name		= "ttySA",
 	.major			= SERIAL_SA1100_MAJOR,
 	.minor			= MINOR_START,
 	.nr			= NR_PORTS,
--- gregkh-2.6.orig/drivers/serial/serial_core.c
+++ gregkh-2.6/drivers/serial/serial_core.c
@@ -2189,7 +2189,6 @@ int uart_register_driver(struct uart_dri
 
 	normal->owner		= drv->owner;
 	normal->driver_name	= drv->driver_name;
-	normal->devfs_name	= drv->devfs_name;
 	normal->name		= drv->dev_name;
 	normal->major		= drv->major;
 	normal->minor_start	= drv->minor;
@@ -2332,7 +2331,7 @@ int uart_remove_one_port(struct uart_dri
 	mutex_lock(&port_mutex);
 
 	/*
-	 * Remove the devices from devfs
+	 * Remove the devices from the tty layer
 	 */
 	tty_unregister_device(drv->tty_driver, port->line);
 
--- gregkh-2.6.orig/drivers/serial/serial_txx9.c
+++ gregkh-2.6/drivers/serial/serial_txx9.c
@@ -69,12 +69,10 @@ static char *serial_name = "TX39/49 Seri
 #if !defined(CONFIG_SERIAL_TXX9_STDSERIAL)
 /* "ttyS" is used for standard serial driver */
 #define TXX9_TTY_NAME "ttyTX"
-#define TXX9_TTY_DEVFS_NAME "tttx/"
 #define TXX9_TTY_MINOR_START	(64 + 64)	/* ttyTX0(128), ttyTX1(129) */
 #else
 /* acts like standard serial driver */
 #define TXX9_TTY_NAME "ttyS"
-#define TXX9_TTY_DEVFS_NAME "tts/"
 #define TXX9_TTY_MINOR_START	64
 #endif
 #define TXX9_TTY_MAJOR	TTY_MAJOR
@@ -971,7 +969,6 @@ console_initcall(serial_txx9_console_ini
 static struct uart_driver serial_txx9_reg = {
 	.owner			= THIS_MODULE,
 	.driver_name		= "serial_txx9",
-	.devfs_name		= TXX9_TTY_DEVFS_NAME,
 	.dev_name		= TXX9_TTY_NAME,
 	.major			= TXX9_TTY_MAJOR,
 	.minor			= TXX9_TTY_MINOR_START,
--- gregkh-2.6.orig/drivers/serial/sh-sci.c
+++ gregkh-2.6/drivers/serial/sh-sci.c
@@ -1699,9 +1699,6 @@ static char banner[] __initdata =
 static struct uart_driver sci_uart_driver = {
 	.owner		= THIS_MODULE,
 	.driver_name	= "sci",
-#ifdef CONFIG_DEVFS_FS
-	.devfs_name	= "ttsc/",
-#endif
 	.dev_name	= "ttySC",
 	.major		= SCI_MAJOR,
 	.minor		= SCI_MINOR_START,
--- gregkh-2.6.orig/drivers/serial/sunsab.c
+++ gregkh-2.6/drivers/serial/sunsab.c
@@ -851,7 +851,6 @@ static struct uart_ops sunsab_pops = {
 static struct uart_driver sunsab_reg = {
 	.owner			= THIS_MODULE,
 	.driver_name		= "serial",
-	.devfs_name		= "tts/",
 	.dev_name		= "ttyS",
 	.major			= TTY_MAJOR,
 };
--- gregkh-2.6.orig/drivers/serial/sunsu.c
+++ gregkh-2.6/drivers/serial/sunsu.c
@@ -1268,7 +1268,6 @@ out:
 static struct uart_driver sunsu_reg = {
 	.owner			= THIS_MODULE,
 	.driver_name		= "serial",
-	.devfs_name		= "tts/",
 	.dev_name		= "ttyS",
 	.major			= TTY_MAJOR,
 };
--- gregkh-2.6.orig/drivers/serial/sunzilog.c
+++ gregkh-2.6/drivers/serial/sunzilog.c
@@ -1017,7 +1017,6 @@ static int zilog_irq = -1;
 static struct uart_driver sunzilog_reg = {
 	.owner		=	THIS_MODULE,
 	.driver_name	=	"ttyS",
-	.devfs_name	=	"tts/",
 	.dev_name	=	"ttyS",
 	.major		=	TTY_MAJOR,
 };
--- gregkh-2.6.orig/drivers/serial/v850e_uart.c
+++ gregkh-2.6/drivers/serial/v850e_uart.c
@@ -468,7 +468,6 @@ static struct uart_ops v850e_uart_ops = 
 static struct uart_driver v850e_uart_driver = {
 	.owner			= THIS_MODULE,
 	.driver_name		= "v850e_uart",
-	.devfs_name		= "tts/",
 	.dev_name		= "ttyS",
 	.major			= TTY_MAJOR,
 	.minor			= V850E_UART_MINOR_BASE,
--- gregkh-2.6.orig/drivers/serial/vr41xx_siu.c
+++ gregkh-2.6/drivers/serial/vr41xx_siu.c
@@ -911,7 +911,6 @@ static struct uart_driver siu_uart_drive
 	.owner		= THIS_MODULE,
 	.driver_name	= "SIU",
 	.dev_name	= "ttyVR",
-	.devfs_name	= "ttvr/",
 	.major		= SIU_MAJOR,
 	.minor		= SIU_MINOR_BASE,
 	.cons		= SERIAL_VR41XX_CONSOLE,
--- gregkh-2.6.orig/include/linux/serial_core.h
+++ gregkh-2.6/include/linux/serial_core.h
@@ -333,7 +333,6 @@ struct uart_driver {
 	struct module		*owner;
 	const char		*driver_name;
 	const char		*dev_name;
-	const char		*devfs_name;
 	int			 major;
 	int			 minor;
 	int			 nr;
