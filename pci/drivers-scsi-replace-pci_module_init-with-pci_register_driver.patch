From linux-kernel-owner+greg=40kroah.com-S1751414AbVK3AAU@vger.kernel.org Tue Nov 29 16:05:29 2005
Date: Wed, 30 Nov 2005 01:00:15 +0100 (MET)
From: Richard Knutsson <ricknu-0@student.ltu.se>
Cc: Richard Knutsson <ricknu-0@student.ltu.se>
Message-Id: <20051130000525.1009.32824.sendpatchset@thinktank.campus.ltu.se>
Subject: [PATCH 4/6] drivers/scsi: Replace pci_module_init() with pci_register_driver()

From: Richard Knutsson <ricknu-0@student.ltu.se>

Replace obsolete pci_module_init() with pci_register_driver().

Signed-off-by: Richard Knutsson <ricknu-0@student.ltu.se>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/scsi/3w-9xxx.c                 |    2 +-
 drivers/scsi/3w-xxxx.c                 |    2 +-
 drivers/scsi/a100u2w.c                 |    2 +-
 drivers/scsi/ahci.c                    |    2 +-
 drivers/scsi/aic7xxx/aic79xx_osm_pci.c |    2 +-
 drivers/scsi/aic7xxx/aic7xxx_osm_pci.c |    2 +-
 drivers/scsi/ata_piix.c                |    4 ++--
 drivers/scsi/dc395x.c                  |    2 +-
 drivers/scsi/dmx3191d.c                |    2 +-
 drivers/scsi/ipr.c                     |    2 +-
 drivers/scsi/ips.c                     |    2 +-
 drivers/scsi/megaraid.c                |    2 +-
 drivers/scsi/megaraid/megaraid_sas.c   |    2 +-
 drivers/scsi/nsp32.c                   |    2 +-
 drivers/scsi/pdc_adma.c                |    2 +-
 drivers/scsi/qla1280.c                 |    2 +-
 drivers/scsi/qla2xxx/ql2100.c          |    2 +-
 drivers/scsi/qla2xxx/ql2200.c          |    2 +-
 drivers/scsi/qla2xxx/ql2300.c          |    2 +-
 drivers/scsi/qla2xxx/ql2322.c          |    2 +-
 drivers/scsi/qla2xxx/ql6312.c          |    2 +-
 drivers/scsi/qla2xxx/qla_os.c          |    2 +-
 drivers/scsi/sata_mv.c                 |    2 +-
 drivers/scsi/sata_nv.c                 |    2 +-
 drivers/scsi/sata_promise.c            |    2 +-
 drivers/scsi/sata_qstor.c              |    2 +-
 drivers/scsi/sata_sil.c                |    2 +-
 drivers/scsi/sata_sil24.c              |    2 +-
 drivers/scsi/sata_sis.c                |    2 +-
 drivers/scsi/sata_svw.c                |    2 +-
 drivers/scsi/sata_sx4.c                |    2 +-
 drivers/scsi/sata_uli.c                |    2 +-
 drivers/scsi/sata_via.c                |    2 +-
 drivers/scsi/sata_vsc.c                |    2 +-
 drivers/scsi/tmscsim.c                 |    2 +-
 35 files changed, 36 insertions(+), 36 deletions(-)

--- gregkh-2.6.orig/drivers/scsi/3w-9xxx.c
+++ gregkh-2.6/drivers/scsi/3w-9xxx.c
@@ -2206,7 +2206,7 @@ static int __init twa_init(void)
 {
 	printk(KERN_WARNING "3ware 9000 Storage Controller device driver for Linux v%s.\n", TW_DRIVER_VERSION);
 
-	return pci_module_init(&twa_driver);
+	return pci_register_driver(&twa_driver);
 } /* End twa_init() */
 
 /* This function is called on driver exit */
--- gregkh-2.6.orig/drivers/scsi/3w-xxxx.c
+++ gregkh-2.6/drivers/scsi/3w-xxxx.c
@@ -2482,7 +2482,7 @@ static int __init tw_init(void)
 {
 	printk(KERN_WARNING "3ware Storage Controller device driver for Linux v%s.\n", TW_DRIVER_VERSION);
 
-	return pci_module_init(&tw_driver);
+	return pci_register_driver(&tw_driver);
 } /* End tw_init() */
 
 /* This function is called on driver exit */
--- gregkh-2.6.orig/drivers/scsi/a100u2w.c
+++ gregkh-2.6/drivers/scsi/a100u2w.c
@@ -1186,7 +1186,7 @@ static struct pci_driver inia100_pci_dri
 
 static int __init inia100_init(void)
 {
-	return pci_module_init(&inia100_pci_driver);
+	return pci_register_driver(&inia100_pci_driver);
 }
 
 static void __exit inia100_exit(void)
--- gregkh-2.6.orig/drivers/scsi/ahci.c
+++ gregkh-2.6/drivers/scsi/ahci.c
@@ -1140,7 +1140,7 @@ static void ahci_remove_one (struct pci_
 
 static int __init ahci_init(void)
 {
-	return pci_module_init(&ahci_pci_driver);
+	return pci_register_driver(&ahci_pci_driver);
 }
 
 static void __exit ahci_exit(void)
--- gregkh-2.6.orig/drivers/scsi/aic7xxx/aic79xx_osm_pci.c
+++ gregkh-2.6/drivers/scsi/aic7xxx/aic79xx_osm_pci.c
@@ -198,7 +198,7 @@ ahd_linux_pci_dev_probe(struct pci_dev *
 int
 ahd_linux_pci_init(void)
 {
-	return (pci_module_init(&aic79xx_pci_driver));
+	return (pci_register_driver(&aic79xx_pci_driver));
 }
 
 void
--- gregkh-2.6.orig/drivers/scsi/aic7xxx/aic7xxx_osm_pci.c
+++ gregkh-2.6/drivers/scsi/aic7xxx/aic7xxx_osm_pci.c
@@ -246,7 +246,7 @@ int
 ahc_linux_pci_init(void)
 {
 	/* Translate error or zero return into zero or one */
-	return pci_module_init(&aic7xxx_pci_driver) ? 0 : 1;
+	return pci_register_driver(&aic7xxx_pci_driver) ? 0 : 1;
 }
 
 void
--- gregkh-2.6.orig/drivers/scsi/ata_piix.c
+++ gregkh-2.6/drivers/scsi/ata_piix.c
@@ -684,8 +684,8 @@ static int __init piix_init(void)
 {
 	int rc;
 
-	DPRINTK("pci_module_init\n");
-	rc = pci_module_init(&piix_pci_driver);
+	DPRINTK("pci_register_driver\n");
+	rc = pci_register_driver(&piix_pci_driver);
 	if (rc)
 		return rc;
 
--- gregkh-2.6.orig/drivers/scsi/dc395x.c
+++ gregkh-2.6/drivers/scsi/dc395x.c
@@ -4921,7 +4921,7 @@ static struct pci_driver dc395x_driver =
  **/
 static int __init dc395x_module_init(void)
 {
-	return pci_module_init(&dc395x_driver);
+	return pci_register_driver(&dc395x_driver);
 }
 
 
--- gregkh-2.6.orig/drivers/scsi/dmx3191d.c
+++ gregkh-2.6/drivers/scsi/dmx3191d.c
@@ -155,7 +155,7 @@ static struct pci_driver dmx3191d_pci_dr
 
 static int __init dmx3191d_init(void)
 {
-	return pci_module_init(&dmx3191d_pci_driver);
+	return pci_register_driver(&dmx3191d_pci_driver);
 }
 
 static void __exit dmx3191d_exit(void)
--- gregkh-2.6.orig/drivers/scsi/ipr.c
+++ gregkh-2.6/drivers/scsi/ipr.c
@@ -6736,7 +6736,7 @@ static int __init ipr_init(void)
 	ipr_info("IBM Power RAID SCSI Device Driver version: %s %s\n",
 		 IPR_DRIVER_VERSION, IPR_DRIVER_DATE);
 
-	return pci_module_init(&ipr_driver);
+	return pci_register_driver(&ipr_driver);
 }
 
 /**
--- gregkh-2.6.orig/drivers/scsi/ips.c
+++ gregkh-2.6/drivers/scsi/ips.c
@@ -7073,7 +7073,7 @@ ips_remove_device(struct pci_dev *pci_de
 static int __init
 ips_module_init(void)
 {
-	if (pci_module_init(&ips_pci_driver) < 0)
+	if (pci_register_driver(&ips_pci_driver) < 0)
 		return -ENODEV;
 	ips_driver_template.module = THIS_MODULE;
 	ips_order_controllers();
--- gregkh-2.6.orig/drivers/scsi/megaraid/megaraid_sas.c
+++ gregkh-2.6/drivers/scsi/megaraid/megaraid_sas.c
@@ -2768,7 +2768,7 @@ static int __init megasas_init(void)
 	/*
 	 * Register ourselves as PCI hotplug module
 	 */
-	rval = pci_module_init(&megasas_pci_driver);
+	rval = pci_register_driver(&megasas_pci_driver);
 
 	if (rval) {
 		printk(KERN_DEBUG "megasas: PCI hotplug regisration failed \n");
--- gregkh-2.6.orig/drivers/scsi/megaraid.c
+++ gregkh-2.6/drivers/scsi/megaraid.c
@@ -5081,7 +5081,7 @@ static int __init megaraid_init(void)
 				"megaraid: failed to create megaraid root\n");
 	}
 #endif
-	error = pci_module_init(&megaraid_pci_driver);
+	error = pci_register_driver(&megaraid_pci_driver);
 	if (error) {
 #ifdef CONFIG_PROC_FS
 		remove_proc_entry("megaraid", &proc_root);
--- gregkh-2.6.orig/drivers/scsi/nsp32.c
+++ gregkh-2.6/drivers/scsi/nsp32.c
@@ -3574,7 +3574,7 @@ static struct pci_driver nsp32_driver = 
  */
 static int __init init_nsp32(void) {
 	nsp32_msg(KERN_INFO, "loading...");
-	return pci_module_init(&nsp32_driver);
+	return pci_register_driver(&nsp32_driver);
 }
 
 static void __exit exit_nsp32(void) {
--- gregkh-2.6.orig/drivers/scsi/pdc_adma.c
+++ gregkh-2.6/drivers/scsi/pdc_adma.c
@@ -722,7 +722,7 @@ err_out:
 
 static int __init adma_ata_init(void)
 {
-	return pci_module_init(&adma_ata_pci_driver);
+	return pci_register_driver(&adma_ata_pci_driver);
 }
 
 static void __exit adma_ata_exit(void)
--- gregkh-2.6.orig/drivers/scsi/qla1280.c
+++ gregkh-2.6/drivers/scsi/qla1280.c
@@ -4772,7 +4772,7 @@ qla1280_init(void)
 		qla1280_setup(qla1280);
 #endif
 
-	return pci_module_init(&qla1280_pci_driver);
+	return pci_register_driver(&qla1280_pci_driver);
 }
 
 static void __exit
--- gregkh-2.6.orig/drivers/scsi/qla2xxx/ql2100.c
+++ gregkh-2.6/drivers/scsi/qla2xxx/ql2100.c
@@ -73,7 +73,7 @@ static struct pci_driver qla2100_pci_dri
 static int __init
 qla2100_init(void)
 {
-	return pci_module_init(&qla2100_pci_driver);
+	return pci_register_driver(&qla2100_pci_driver);
 }
 
 static void __exit
--- gregkh-2.6.orig/drivers/scsi/qla2xxx/ql2200.c
+++ gregkh-2.6/drivers/scsi/qla2xxx/ql2200.c
@@ -73,7 +73,7 @@ static struct pci_driver qla2200_pci_dri
 static int __init
 qla2200_init(void)
 {
-	return pci_module_init(&qla2200_pci_driver);
+	return pci_register_driver(&qla2200_pci_driver);
 }
 
 static void __exit
--- gregkh-2.6.orig/drivers/scsi/qla2xxx/ql2300.c
+++ gregkh-2.6/drivers/scsi/qla2xxx/ql2300.c
@@ -84,7 +84,7 @@ static struct pci_driver qla2300_pci_dri
 static int __init
 qla2300_init(void)
 {
-	return pci_module_init(&qla2300_pci_driver);
+	return pci_register_driver(&qla2300_pci_driver);
 }
 
 static void __exit
--- gregkh-2.6.orig/drivers/scsi/qla2xxx/ql2322.c
+++ gregkh-2.6/drivers/scsi/qla2xxx/ql2322.c
@@ -89,7 +89,7 @@ static struct pci_driver qla2322_pci_dri
 static int __init
 qla2322_init(void)
 {
-	return pci_module_init(&qla2322_pci_driver);
+	return pci_register_driver(&qla2322_pci_driver);
 }
 
 static void __exit
--- gregkh-2.6.orig/drivers/scsi/qla2xxx/ql6312.c
+++ gregkh-2.6/drivers/scsi/qla2xxx/ql6312.c
@@ -83,7 +83,7 @@ static struct pci_driver qla6312_pci_dri
 static int __init
 qla6312_init(void)
 {
-	return pci_module_init(&qla6312_pci_driver);
+	return pci_register_driver(&qla6312_pci_driver);
 }
 
 static void __exit
--- gregkh-2.6.orig/drivers/scsi/qla2xxx/qla_os.c
+++ gregkh-2.6/drivers/scsi/qla2xxx/qla_os.c
@@ -2565,7 +2565,7 @@ qla2x00_module_init(void)
 		return -ENODEV;
 
 	printk(KERN_INFO "QLogic Fibre Channel HBA Driver\n");
-	ret = pci_module_init(&qla2xxx_pci_driver);
+	ret = pci_register_driver(&qla2xxx_pci_driver);
 	if (ret) {
 		kmem_cache_destroy(srb_cachep);
 		fc_release_transport(qla2xxx_transport_template);
--- gregkh-2.6.orig/drivers/scsi/sata_mv.c
+++ gregkh-2.6/drivers/scsi/sata_mv.c
@@ -2229,7 +2229,7 @@ err_out:
 
 static int __init mv_init(void)
 {
-	return pci_module_init(&mv_pci_driver);
+	return pci_register_driver(&mv_pci_driver);
 }
 
 static void __exit mv_exit(void)
--- gregkh-2.6.orig/drivers/scsi/sata_nv.c
+++ gregkh-2.6/drivers/scsi/sata_nv.c
@@ -591,7 +591,7 @@ static void nv_check_hotplug_ck804(struc
 
 static int __init nv_init(void)
 {
-	return pci_module_init(&nv_pci_driver);
+	return pci_register_driver(&nv_pci_driver);
 }
 
 static void __exit nv_exit(void)
--- gregkh-2.6.orig/drivers/scsi/sata_promise.c
+++ gregkh-2.6/drivers/scsi/sata_promise.c
@@ -743,7 +743,7 @@ err_out:
 
 static int __init pdc_ata_init(void)
 {
-	return pci_module_init(&pdc_ata_pci_driver);
+	return pci_register_driver(&pdc_ata_pci_driver);
 }
 
 
--- gregkh-2.6.orig/drivers/scsi/sata_qstor.c
+++ gregkh-2.6/drivers/scsi/sata_qstor.c
@@ -712,7 +712,7 @@ err_out:
 
 static int __init qs_ata_init(void)
 {
-	return pci_module_init(&qs_ata_pci_driver);
+	return pci_register_driver(&qs_ata_pci_driver);
 }
 
 static void __exit qs_ata_exit(void)
--- gregkh-2.6.orig/drivers/scsi/sata_sil24.c
+++ gregkh-2.6/drivers/scsi/sata_sil24.c
@@ -1017,7 +1017,7 @@ static int sil24_init_one(struct pci_dev
 
 static int __init sil24_init(void)
 {
-	return pci_module_init(&sil24_pci_driver);
+	return pci_register_driver(&sil24_pci_driver);
 }
 
 static void __exit sil24_exit(void)
--- gregkh-2.6.orig/drivers/scsi/sata_sil.c
+++ gregkh-2.6/drivers/scsi/sata_sil.c
@@ -512,7 +512,7 @@ err_out:
 
 static int __init sil_init(void)
 {
-	return pci_module_init(&sil_pci_driver);
+	return pci_register_driver(&sil_pci_driver);
 }
 
 static void __exit sil_exit(void)
--- gregkh-2.6.orig/drivers/scsi/sata_sis.c
+++ gregkh-2.6/drivers/scsi/sata_sis.c
@@ -335,7 +335,7 @@ err_out:
 
 static int __init sis_init(void)
 {
-	return pci_module_init(&sis_pci_driver);
+	return pci_register_driver(&sis_pci_driver);
 }
 
 static void __exit sis_exit(void)
--- gregkh-2.6.orig/drivers/scsi/sata_svw.c
+++ gregkh-2.6/drivers/scsi/sata_svw.c
@@ -485,7 +485,7 @@ static struct pci_driver k2_sata_pci_dri
 
 static int __init k2_sata_init(void)
 {
-	return pci_module_init(&k2_sata_pci_driver);
+	return pci_register_driver(&k2_sata_pci_driver);
 }
 
 
--- gregkh-2.6.orig/drivers/scsi/sata_sx4.c
+++ gregkh-2.6/drivers/scsi/sata_sx4.c
@@ -1495,7 +1495,7 @@ err_out:
 
 static int __init pdc_sata_init(void)
 {
-	return pci_module_init(&pdc_sata_pci_driver);
+	return pci_register_driver(&pdc_sata_pci_driver);
 }
 
 
--- gregkh-2.6.orig/drivers/scsi/sata_uli.c
+++ gregkh-2.6/drivers/scsi/sata_uli.c
@@ -272,7 +272,7 @@ err_out:
 
 static int __init uli_init(void)
 {
-	return pci_module_init(&uli_pci_driver);
+	return pci_register_driver(&uli_pci_driver);
 }
 
 static void __exit uli_exit(void)
--- gregkh-2.6.orig/drivers/scsi/sata_via.c
+++ gregkh-2.6/drivers/scsi/sata_via.c
@@ -382,7 +382,7 @@ err_out:
 
 static int __init svia_init(void)
 {
-	return pci_module_init(&svia_pci_driver);
+	return pci_register_driver(&svia_pci_driver);
 }
 
 static void __exit svia_exit(void)
--- gregkh-2.6.orig/drivers/scsi/sata_vsc.c
+++ gregkh-2.6/drivers/scsi/sata_vsc.c
@@ -417,7 +417,7 @@ static struct pci_driver vsc_sata_pci_dr
 
 static int __init vsc_sata_init(void)
 {
-	return pci_module_init(&vsc_sata_pci_driver);
+	return pci_register_driver(&vsc_sata_pci_driver);
 }
 
 
--- gregkh-2.6.orig/drivers/scsi/tmscsim.c
+++ gregkh-2.6/drivers/scsi/tmscsim.c
@@ -2671,7 +2671,7 @@ static int __init dc390_module_init(void
 		printk (KERN_INFO "DC390: Using safe settings.\n");
 	}
 
-	return pci_module_init(&dc390_driver);
+	return pci_register_driver(&dc390_driver);
 }
 
 static void __exit dc390_module_exit(void)
