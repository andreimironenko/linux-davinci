From owner-linux-pci@atrey.karlin.mff.cuni.cz Fri Apr 28 11:28:26 2006
From: Kristen Accardi <kristen.c.accardi@intel.com>
Subject: PCI: don't enable device if already enabled
Cc: arjan@linux.intel.com, greg@kroah.com
Date: Fri, 28 Apr 2006 11:37:38 -0700
Message-Id: <1146249458.25490.12.camel@whizzy>

If a device is already enabled, don't bother reenabling it.

Signed-off-by: Kristen Carlson Accardi <kristen.c.accardi@intel.com>
Acked-By: Arjan van de Ven <arjan@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>


---
 drivers/pci/pci.c |    9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

--- gregkh-2.6.orig/drivers/pci/pci.c
+++ gregkh-2.6/drivers/pci/pci.c
@@ -521,10 +521,11 @@ pci_enable_device_bars(struct pci_dev *d
 int
 pci_enable_device(struct pci_dev *dev)
 {
-	int err = pci_enable_device_bars(dev, (1 << PCI_NUM_RESOURCES) - 1);
-	if (err)
-		return err;
-	return 0;
+	int err = 0;
+
+	if (!dev->is_enabled)
+		err = pci_enable_device_bars(dev, (1 << PCI_NUM_RESOURCES) - 1);
+	return err;
 }
 
 /**
