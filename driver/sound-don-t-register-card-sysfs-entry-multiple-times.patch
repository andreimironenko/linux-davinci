From tiwai@suse.de  Mon Nov 13 09:34:42 2006
Date: Mon, 06 Nov 2006 16:34:51 +0100
Message-ID: <s5hvelsfv1g.wl%tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Greg KH <greg@kroah.com>
Cc: Damien Wyart <damien.wyart@free.fr>, Andrew Morton <akpm@osdl.org>, <James@superbug.demon.co.uk>
Subject: Sound: don't register card sysfs entry multiple times
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII


[PATCH] Don't register card* sysfs entry multiple times

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 sound/core/init.c |   10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

--- gregkh-2.6.orig/sound/core/init.c
+++ gregkh-2.6/sound/core/init.c
@@ -496,10 +496,12 @@ int snd_card_register(struct snd_card *c
 	int err;
 
 	snd_assert(card != NULL, return -EINVAL);
-	card->dev = device_create(sound_class, card->parent, 0, "card%i",
-				  card->number);
-	if (IS_ERR(card->dev))
-		card->dev = NULL;
+	if (!card->dev) {
+		card->dev = device_create(sound_class, card->parent, 0,
+					  "card%i", card->number);
+		if (IS_ERR(card->dev))
+			card->dev = NULL;
+	}
 	if ((err = snd_device_register_all(card)) < 0)
 		return err;
 	mutex_lock(&snd_card_mutex);
